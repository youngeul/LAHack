<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en" ng-app="myApp" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html lang="en" ng-app="myApp" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html lang="en" ng-app="myApp" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en" ng-app="myApp" class="no-js"> <!--<![endif]-->
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>My AngularJS App</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="lib/html5-boilerplate/dist/css/normalize.css">
  <link rel="stylesheet" href="lib/html5-boilerplate/dist/css/main.css">
  <link rel="stylesheet" href="app.css">
  <script src="lib/html5-boilerplate/dist/js/vendor/modernizr-2.8.3.min.js"></script>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <style>
    .hand-div {
      display: block;
      float: left;
      margin-left: 20px;
      width: 60%;
      height: 100%;
    }
    .hand {
      position: fixed;
    }
  </style>
  <script>
    var text = '{\"time_per_status\": 0.8, \"status\": [{\"current\": 0, \"steps\": {\"time\": [0.6, 0, 0, 0, 0.1, 0.1], \"percent\": [15.0, 0.0, 0.0, 0.0, 2.5, 2.5]}, \"total\": {\"time\": 0.8, \"percent\": 3}}, {\"current\": 0, \"steps\": {\"time\": [1.3, 0, 0, 0, 0.1, 0.2], \"percent\": [32.5, 0.0, 0.0, 0.0, 2.5, 5.0]}, \"total\": {\"time\": 1.6, \"percent\": 7}}, {\"current\": 0, \"steps\": {\"time\": [1.95, 0, 0, 0, 0.1, 0.35], \"percent\": [48.75, 0.0, 0.0, 0.0, 2.5, 8.75]}, \"total\": {\"time\": 2.4, \"percent\": 10}}, {\"current\": 1, \"steps\": {\"time\": [2.63, 0, 0, 0, 0.1, 0.47], \"percent\": [65.83, 0.0, 0.0, 0.0, 2.5, 11.67]}, \"total\": {\"time\": 3.2, \"percent\": 13}}, {\"current\": 1, \"steps\": {\"time\": [3.25, 0, 0, 0, 0.1, 0.65], \"percent\": [81.25, 0.0, 0.0, 0.0, 2.5, 16.25]}, \"total\": {\"time\": 4.0, \"percent\": 17}}, {\"current\": 1, \"steps\": {\"time\": [3.67, 0.35, 0, 0, 0.13, 0.65], \"percent\": [91.67, 8.75, 0.0, 0.0, 3.33, 16.25]}, \"total\": {\"time\": 4.8, \"percent\": 20}}, {\"current\": 1, \"steps\": {\"time\": [3.72, 1.1, 0, 0, 0.13, 0.65], \"percent\": [92.92, 27.5, 0.0, 0.0, 3.33, 16.25]}, \"total\": {\"time\": 5.6, \"percent\": 23}}, {\"current\": 3, \"steps\": {\"time\": [3.72, 1.88, 0, 0, 0.13, 0.67], \"percent\": [92.92, 47.08, 0.0, 0.0, 3.33, 16.67]}, \"total\": {\"time\": 6.4, \"percent\": 27}}, {\"current\": 3, \"steps\": {\"time\": [3.72, 1.95, 0, 0.32, 0.13, 1.08], \"percent\": [92.92, 48.75, 0.0, 7.92, 3.33, 27.08]}, \"total\": {\"time\": 7.2, \"percent\": 30}}, {\"current\": 3, \"steps\": {\"time\": [3.72, 1.95, 0, 1.02, 0.13, 1.18], \"percent\": [92.92, 48.75, 0.0, 25.42, 3.33, 29.58]}, \"total\": {\"time\": 8.0, \"percent\": 33}}, {\"current\": 3, \"steps\": {\"time\": [3.72, 1.95, 0, 1.82, 0.13, 1.18], \"percent\": [92.92, 48.75, 0.0, 45.42, 3.33, 29.58]}, \"total\": {\"time\": 8.8, \"percent\": 37}}, {\"current\": 3, \"steps\": {\"time\": [3.72, 1.95, 0, 2.52, 0.13, 1.28], \"percent\": [92.92, 48.75, 0.0, 62.92, 3.33, 32.08]}, \"total\": {\"time\": 9.6, \"percent\": 40}}, {\"current\": 3, \"steps\": {\"time\": [3.72, 1.95, 0, 3.18, 0.13, 1.42], \"percent\": [92.92, 48.75, 0.0, 79.58, 3.33, 35.42]}, \"total\": {\"time\": 10.4, \"percent\": 43}}, {\"current\": 5, \"steps\": {\"time\": [3.72, 1.95, 0, 3.95, 0.13, 1.45], \"percent\": [92.92, 48.75, 0.0, 98.75, 3.33, 36.25]}, \"total\": {\"time\": 11.2, \"percent\": 47}}, {\"current\": 5, \"steps\": {\"time\": [3.75, 1.95, 0, 4.23, 0.13, 1.93], \"percent\": [93.75, 48.75, 0.0, 105.83, 3.33, 48.33]}, \"total\": {\"time\": 12.0, \"percent\": 50}}, {\"current\": 5, \"steps\": {\"time\": [3.75, 1.95, 0, 4.23, 0.13, 2.07], \"percent\": [93.75, 48.75, 0.0, 105.83, 3.33, 51.67]}, \"total\": {\"time\": 12.133333333333333, \"percent\": 51}}]}';
    var obj_json = JSON.parse(text);

    window.onload = init;

    function init() {
      // json parse
      /*
      function request(){
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          var myObj = JSON.parse(this.responseText);
        }
      };
      xmlhttp.open("GET", "json_demo.txt", true);
      xmlhttp.send();
      }
      */
      var time_per_status = obj_json.time_per_status;
      var num_step = obj_json.status.length;
      var total_time = obj_json.status[obj_json.status.length-1].total.time;

      var step = document.querySelector(".step > span");
      var step_image = document.querySelector(".step_image");
      var percent = document.querySelector(".percent");
      //video = document.querySelector(".video");
      //var red_hand = document.querySelector(".red_hand");
      var video_mine =  document.querySelector(".video_mine");



      //wrapper_step = document.querySelector(".wrapper_step");
      //video.style = "offsetHeight:"+wrapper_step.offsetHeight+";";
      //console.log(wrapper_step.offsetHeight);
      //console.log(video.offsetHeight);

      //hand_status = document.querySelectorAll(".hand-div > .hand-status");
      var hand_image = document.querySelector(".hand");

      video_mine.play();
      video_mine.loop = true;

      var idx = 0;
      interval = setInterval(function(){


        console.log(obj_json.status[idx]);

        var current_step = obj_json.status[idx].current+1;
        //console.log(current_step);
        step.innerText = current_step;
        step_image.src = "static/step" + current_step +".png";

        hand_image.src = "static/hand/hand_wash" + current_step +".png";
        //red_hand.innerText = "red hand image "+num_step;

        //for (let i=0; i < 6; i++) {
          //console.log(obj_json.status[idx].steps.percent[i]);
          //hand_status[i].style.opacity = (1 - obj_json.status[idx].steps.percent[i]);
        //}

        idx += 1;



        percent.style = "width:" + (100/num_step*idx) + "%";
        percent.innerText = (100/num_step*idx) + "%";

        //console.log(idx);

        if (idx == num_step) {
          percent.innerText = "100%";
          video_mine.pause();
          clearInterval(interval)
          //alert("Good Job!");
        }


      }, time_per_status * 1000);
    }
  </script>

</head>
<body>
<div class="text-center">
  <img class="img-fluid" src="static/wash_hand_text.png" alt="step" style="height: 100px;">
</div>

<div style="background-image: linear-gradient(-90deg, skyblue, white); height: 21%; width: 100%; text-align: center;">
  <div class="row" style="padding: 10px; padding-right: 15px;padding-left: 15px">
    <div class="col-7" style="background-color: white;border-radius: 25px;">
      <div class="text-center wrapper_step" style="margin: 0;padding: 0;">
        <div class="text-center step" style="">Step <span>1</span></div>
        <img class="img-fluid step_image" src="static/step1.png" alt="step" style="width: 100%;height: 115px;">
      </div>
    </div>

    <div class="col-5 text-center" style="padding-top=0;padding-bottom=0;margin-top: auto;margin-bottom: auto;">
      <video class="video_mine" src="static/demo.mov" width="100%" muted="muted" style="border-radius: 25px;"></video>
    </div>
  </div>
</div>

<div class="text-center" style="padding: 10px;">
  <div class="progress">
    <div class="progress-bar progress-bar-striped progress-bar-animated percent" style="width:0%;">0%</div>
  </div>
</div>

<div class="">
  <div class="hand-div">
    <img class="hand" src="./static/hand.png" style="width: 350px;height: 370px;">
    <img class="img-responsive" src="./static/hand.png" style="width: 350px;height: 370px; alt="">
    <!--
    <img class="hand hand-status" src="./static/hand/hand1.png" style="width: 350px;height: 370px;">
    <img class="hand hand-status" src="./static/hand/hand2.png" style="width: 350px;height: 370px;">
    <img class="hand hand-status" src="./static/hand/hand3.png" style="width: 350px;height: 370px;">
    <img class="hand hand-status" src="./static/hand/hand4.png" style="width: 350px;height: 370px;">
    <img class="hand hand-status" src="./static/hand/hand5.png" style="width: 350px;height: 370px;">
    <img class="hand hand-status" src="./static/hand/hand6.png" style="width: 350px;height: 370px;">
    -->
  </div>
</div>


</div>


<!--
<div>AngularJS seed app: v<span app-version></span></div>
-->
<!-- In production use:
<script src="//ajax.googleapis.com/ajax/libs/angularjs/x.x.x/angular.min.js"></script>
-->
<script src="lib/angular/angular.js"></script>
<script src="lib/angular-route/angular-route.js"></script>
<script src="app.js"></script>
<script src="view1/view1.js"></script>
<script src="view2/view2.js"></script>
<script src="core/version/version.js"></script>
<script src="core/version/version-directive.js"></script>
<script src="core/version/interpolate-filter.js"></script>

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
</body>
</html>